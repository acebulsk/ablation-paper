---
title: "Paper Draft: The Influence of Meteorology on Canopy Snow Ablation Processes"
format: 
  docx:
    reference-doc: ../config/word_template_hp.docx
    number-sections: true
    toc: false
  # pdf
  html:
    toc: false
    self-contained: true
editor: source
bibliography: ../../papers/bibtex/library.bib
csl: '../../papers/bibtex/csl-styles/apa-disable-disambiguate-add-names.csl'
---
 @TODO 
 
 - need to update scripts to include removal of certain troughs for certain events, the goal was to inlcude this filtering in the partitioning script but could also think about justifying removal for all rate analysis too, could also add back in sparse trough for some events but i recall it was underestimating too much throughout all events. 
 - can we justify the parititoning since we expect a diff between the troughs and the tree just due to locational differences so may not be justified analysis... to some extent this likely explains the residual for some of the windy events as the tree is more wind exposed... so we would expect a residual that may not be due to redistribution...
 
 
<!-- For most journals, Research Articles are allowed to be up to 25 publication units (PU), where 1 PU is 500 words or 1 display element (figure or table). Research Letters for Geophysical Research Letters have a maximum length of 12 publication units. Longer papers are not considered in GRL and will be returned for shortening. -->

<!-- Word count does NOT include the title, authors, affiliations, key points, keywords, text in tables (but not captions) and references. Longer papers are assessed an excess length fee. For most journals, Commentaries are limited to 6 publication units (recommended length is about 2000 words and 1-2 figures). -->

```{r}
library(dplyr)
knitr::opts_chunk$set(echo = FALSE, message=FALSE, warning=FALSE, fig.align='center')

source('scripts/00-results-figs-setup.R')
source('scripts/get-manuscript-values.R')

# met averages for periods snow was in the canopy w/o precip
mean_t <- mean(met_unld$t) |> round(1)
mean_u <- mean(met_unld$u) |> round(1)
max_15min_u <- max(met_unld$u) |> round(1)

n_canopy_snow_events <- nrow(canopy_snow_events)
```

**Authors:**

A. Cebulski^1^ (ORCID ID - 0000-0001-7910-5056)

J.W. Pomeroy^1^ (ORCID ID - 0000-0002-4782-7457)

^1^Coldwater Laboratory, University of Saskatchewan, Canmore, Canada

**Corresponding Author:** Alex Cebulski, alexcebulski@gmail.com

**Key Points:**

-   Direct measurements of the canopy snow mass balance using a tree weighing lysimeter and subcanopy lysimeter provide new insights on the interaction of canopy snow ablation processes with meteorology and canopy snow load.
-   The primary processes contributing to canopy snow ablation observed in this study were unloading and drip (60%) with a slightly smaller contribution form sublimation (40%)
-   Canopy snow unloading and drip was observed to be associated with air temperature, wind speed, canopy snow load, and the duration snow has been intercepted in the canopy.

**Abstract:**

The time that snow resides in the canopy, and is subjected to high rates of sublimation, is dependent on rates of canopy snow ablation processes. Previous studies have developed parameterizations to represent ablation processes including unloading, melt, drip and sublimation of snow intercepted in the canopy. However, these parameterizations have been shown to have uncertain transferability to new environments and have not yet been tested in discontinuous forest canopies. This study presents new in-situ measurements of canopy snow ablation processes and contrasts these observations with existing theories and models. Analysis of the canopy snow mass balance showed that unloading, drip and melt contributed to 60% of canopy snow ablation on average over two years with the remainder being attributed to canopy snow sublimation. The probability of unloading, drip and melt was observed to increase with air temperature and wind speed. However, the probability of wind induced unloading was observed to decrease at warmer air temperatures. The probability of unloading due to warming was also observed to decline when wind speeds were above 1 m s^-1^. The increase in cohesion and adhesion of snow in the canopy at warmer temperatures and cooling due to wind-induced evaporation may contribute to the interaction multivariate interaction between air temperature, wind speed and canopy snow unloading. Exponential relationships were observed between both air temperature and wind speed with unloading and drip, which were also dependent on the amount of snow intercepted in the canopy. In comparison to existing models, this discontinuous forest exhibited unloading and drip due to warming at lower air temperatures. Conversely, wind-induced unloading occurred at higher wind speeds than predicted by current models.

## Introduction

The objective of this study is to determine if the theoretical underpinnings and assumptions behind existing canopy snow ablation parameterizations are supported by in-situ observations from this study site. 

Research Questions:

1. What are the dominant processes driving canopy snow ablation as observed in this study site?

2. How do meteorological factors, such as temperature and wind, influence the rates and patterns of snow unloading?

3. To what extent do current theoretical models of canopy snow ablation align with the in-situ observations, and what modifications, if any, are necessary to accurately represent the observed processes?

![Example of the @Hedstrom1998a (HP98) and @Roesch2001 (RW01) parameterizations for the calculation of unloading and drip rates with increasing air temperature. Wind speed for the RW01 parameterization was set to zero. Note that the HP98 parameterization does not differentiate unloading processes (i.e., metamorphasism, wind-induced, melt) while the RW01 parameterization here calculates unloading and drip of canopy snow due to warming and melt alone and their wind-induced parameterization is shown separately.](figs/examples/unloading_drip_hp98_rw01.png){#fig-unl-ex-temp}

![Example of the @Roesch2001 (RW01) parameterization for the calculation of wind-induced unloading. Here the air temperature has been set to a constant of -10°C to set the unloading rate due to warming to zero. The parameterization was run for a range of canopy snow loads (5, 10, 15, and 20 mm).](figs/examples/roesch_unloading.png){#fig-unl-ex-wind}

## Study Site and Instrumentation

The observations presented in this study were collected at Fortress Mountain Research Basin (FMRB), AB, -115° W, 51° N, located within the continental headwaters of the Canadian Rocky Mountains. Meteorology and Lysimeter measurements were collected between October 2021 and July 2023 at Powerline (PWL) and Forest Tower Stations (FT) at ~2100 m asl. (@fig-site-map). The PWL and FT stations are located on a subalpine ridge with discontinuous stands of subalpine fir (Abies lasiocarpa) and Engelmann spruce (Picea engelmannii). Meteorological measurements at FT station include air temperature, relative humidity, wind speed, and wind direction at 4.3 m above the ground (@fig-site-map). The snowfall rate was measured using a weighing precipitation gauge (OTT Pluvio) installed 2.6 m above the ground at PWL station and corrected for undercatch following phase correction by @Harder2013 and catch efficiency by @Macdonald2007a. Additional air temperature and wind speed measurements were utilized from PWL station for gap filling of the FT station time series. The lysimeter measurements included a weighed tree affixed to the flux tower at FT station which measured canopy snow load (kg m^-2^) and three subcanopy lysimeters installed adjacent to FT station which measured the rate of unloading and drip (@fig-site-map). Additional details on this study site and the meteorological and lysimeter measurements have been described in @Cebulski2024c.

Quality control and gap filling of the meteorological and lysimetry data used in this study was conduced using the R programming language @R2022 and the 'CRHMr' R package [@Shook2016]. To isolate the subcanopy lysimeter measurements of canopy snow unloading and drip from throughfall, 47 distinct periods without atmospheric precipitation were selected where snow was also observed to be intercepted in the canopy using the weighed tree and timelapse imagery investigation. Periods without atmospheric precipitation were defined when the precipitation rate observed at PWL station was equal to zero. In-situ 15-minute measurements over these periods showed a mean temperature of `r mean_t` °C and mean mid-canopy wind speed (4.3 m above the ground) of `r mean_u` m s^-1^, reaching a 15-minute average maximum of `r max_15min_u` m s^-1^. 

## Methods

### Partitioning the Canopy Snow Ablation Mass Balance

The canopy snow mass balance was partitioned into its individual components that ablate snow intercepted in the canopy to determine what the dominant ablation processes over the study period. While some components of the canopy snow mass balance can be measured directly with relative ease, such and unloading and drip by [e.g., @Storck2002], wind redistribution and sublimation of canopy snow are more difficult to quantify directly especially in mountain environments [@Helgason2012b]. To account for this the canopy snow mass balance was partitioned into components that were measured in this study, including unloading and drip, and the remaining processes, were lumped into a residual component. For periods where snow was intercepted in the canopy, and atmospheric precipitation was not observed by the PWL snowfall gauge, the canopy snow mass balance [see Equation 1 in @Cebulski2024b] could be simplified to: 

$$
-\frac{dL}{dt} = q_{unld}(L) + q_{drip}(L) + q_{wind}^{veg}(L) + q_{sub}^{veg}(L)
$$ {#eq-canopy-mass-bal}

where $\frac{dL}{dt}$ is the change in canopy snow load over time (kg m^-2^ s^-1^), $q_{unld}(L)$ is the canopy snow unloading rate (kg m^-2^ s^-1^), $q_{drip}(L)$ is the canopy snow drip rate due to canopy snowmelt (kg m^-2^ s^-1^), $q_{wind}^{veg}(L)$ is the wind transport rate of snow by suspension in our out of the control volume (kg m^-2^ s^-1^). The weighed tree lysimeter provided measurements of $\frac{dL}{dt}$ while the subcanopy lysimeters provided measurements of $q_{unld}(L) + q_{drip}(L)$. A residual corresponding to the remaining unmeasured components, $q_{wind}^{veg}(L)$ and $q_{sub}^{veg}(L)$ was calculated by rearranging @eq-canopy-mass-bal as:

$$
q_{wind}^{veg}(L) + q_{sub}^{veg}(L) = \frac{dL}{dt} - \left(q_{unld}(L) + q_{drip}(L)\right)
$$

where a positive residual equates to canopy snow that was ablated from the weighed tree lysimeter and was not accounted for by measurements of $q_{unld}$ and $q_{drip}$. A negative residual may occur when higher rates of $q_{unld}$ + $q_{drip}$, measured by the subcanopy lysimeters, are higher than $\frac{dL}{dt}$, measured by the weighed tree lysimeter. Slight differences in the mass balance at the SCL and weighed tree lysimeters was expected due to the different measurement locations and instrument error. The duration that snow was intercepted in the canopy was also calculated as a potential predictor variable for canopy snow ablation processes. This was calculated for individual snowfall events as the time starting when snowfall stopped and continued as long as the snow resided in the canopy.

### Modelled Canopy Snow Sublimation Rate

The canopy snow sublimation rate was simulated at this study site in order to determine the portion of the canopy snow ablation mass balance residual that was comprised of the wind redistribution compared to sublimation. Two eddy covariance systems were installed with the goal of quantifying canopy snow sublimation rate following methods outlined by @Sexstone2018, however invalidation of the assumptions behind the eddy covariance method at our study site and the resulting invalid measurements prevented the use of these measurements in this analysis. Therefore the canopy snow sublimation rate was modelled using the Cold Regions Hydrological Model (CRHM) which is described in @Pomeroy2007. The @Pomeroy1998 parameterization was used within CRHM to calculate a potential canopy snow sublimation rate (s^-1^) and was then multiplied by the observed canopy snow load (kg m^-2^) measured by the weighed tree at FT station. 

### Probability of Unloading and Drip

A high degree of noise was observed in the canopy snow unloading and drip rate observations as well as the meteorological measurements. To account for this, variables including: air temperature, wind speed, canopy snow load, and the duration that snow was intercepted in the weighed tree was binned and the probability of observing an unloading event within each variable bin was calculated as:

$$
p_{unld} = \frac{n}{N}
$$

where $p_{unld}$ is the probability of unloading (-), $n$ is the number of unloading events that occurred in a particular variables bin, and $N$ is the total number of occurrences of a variable falling within each bin.  

## Results

### The apportionment of Canopy Snow Ablation Processes

@fig-glob-unl-part shows that the measured unloading and drip rate was the dominant process of the canopy snow ablation mass balance over two winter seasons. Simulated sublimation rates also make up a significant portion of canopy snow ablation and accounted for most of the residual measured ablation. This suggests that for the average conditions in this wind-exposed subalpine forest, wind redistribution of snow intercepted in the canopy is a relatively small component.

![](figs/results/canopy_snow_ablation_partition_global.png){#fig-glob-unl-part}

@fig-wind-temp-unl-part shows a large increase in the ablation residual with wind speeds above 3.5 m s^-1^ and little association with air temperature. The increase in the residual at high wind speeds is attributed to higher ablation rates measured by the weighed tree due which were not accounted for by corresponding increase in the unloading + drip rates. The difference between the residual + error term and the modelled sublimation rate is attributed to both an increase in horizontal wind redistribution of snow intercepted in the canopy and instrument error. Difficulties in measuring horizontal wind redistribution and quantify the instrument error limit the ability to partition the residual into these two processes. However, since the sublimation parameterization in this simulation has not been tested in wind-exposed forest and may be an underestimate of true sublimation rates at high wind speeds. Therefore the increase in residual, compared to modelled sublimation could also be attributed to an increase in actual sublimation rate compared to the model. While these data could be used to parameterise a horizontal wind redistribution function, the uncertainty behind this residual term due to the aforementioned issues prove any resultant model to be too speculative. 

![](figs/results/canopy_snow_ablation_partition_cowplot_temp_wind.png){#fig-wind-temp-unl-part}

### The Influence of Meteorology on Unloading

@fig-glob-prob-unl shows the association between the probability of unloading + drip with air temperature and wind speed. The probability of unloading + drip was found to be high (close to 1) for air temperatures above 1 °C and above wind speeds of 2.5 m s^-1^. For wind speeds bins less than 1 m s^-1^ the probability of unloading was found to positively associated with air temperatures. However at higher wind speeds this association of unloading with air temperature was observed to weaken, potentially due to some evaporative cooling. For air temperatures less than -6 °C a positive association between the probability of unloading + drip and wind speed was observed. Above -6 °C the reduced association between wind speed and probability of unloading + drip may be attributed to increased cohesion and adhesion of snow intercepted in the canopy attributed to an increase in liquid water content in the snow clumps. The low frequency of observations shown in @fig-glob-freq-unl, for low and high air temperatures and wind speeds may limit the interpretation of these results.

![](figs/results/probability_of_unloading_wind_air_temp.png){#fig-glob-prob-unl}

![](figs/results/frequency_of_unloading_wind_air_temp.png){#fig-glob-freq-unl}
The probability of unloading was found to start around 0.5 when snow is newly intercepted in the canopy, followed by a decline to around 0.1 after about 10 hours, and following 24 hours the probability of unloading increases up to near 1.0 at 100 hours.

![The probability of unloading with increasing duration that snow is intercepted in the canopy.](figs/results/probability_of_unloading_w_time_rm_warm_windy_periods.png){#fig-low-wind-qunl}

### Modelling Canopy Snow Unloading 

The canopy snow unloading rate due to melt, $q_{unld}^{melt}$ (kg m^-2^ s^-1^) and wind, $q_{unld}^{wind}$ (kg m^-2^ s^-1^) can be represented by:

$$
q_{unld} = q_{unld}^{wind} + q_{unld}^{melt}
$${#eq-unl-ode}

<!-- consider adding Lres to melt unloading function , see eq. 29 in the review paper -->

Canopy snow unloading due to melt of snow intercepted in the canopy was found to be linearly proportional to the canopy snow melt rate, $q_{drip}$. This was represented as the equation as in @Andreadis2009:

$$
q_{unld}^{melt} = X_u \cdot q_{drip}
$$
<!-- TODO create fig showing the increase in mass snow unloading (tree ablation minus sublimation and drip) w/ increasing q_drip. See cal-melt-drip-ratio.R script. -->

Canopy snow unloading due to wind is shown in @fig-mod-wind-unld to increase exponentially with wind speed measured at mid canopy height. The data presented in @fig-mod-wind-unld originates from the SCls and has been filtered to include periods where the air temperature is below -6°C where the effect of canopy snow melt on unloading was observed to be minimal in @fig-glob-prob-unl.

![Canopy snow unloading rate measured by the subcanopy lysimeters during periods where the air temperature is below -6°C. The dots show the mean unloading rate for wind speed bins (0–0.5 m s^-1^, 0.5–1.0 m s^-1^, ..., 5.5–6.0 m s^-1^). The error bars show +/- 1 standard deviation above and below the mean. The fitted lines show predictions from @eq-fu. )](figs/results/modelled_wind_unloading_w_obs.png){#fig-mod-wind-unld}

The equation to represent the model shown in @fig-mod-wind-unld is:

$$
q_{unld}^{wind} = L \cdot f(u)
$$
where $f(u)$ is a wind induced unloading function (s^-1^).

$$
f(u) = \begin{cases}
    0,& \text{if } u < u_{th} \\
    u \cdot a_u \cdot e^{b_u\cdot u},              & \text{if }  u \ge u_{th}
\end{cases}
$$ {#eq-roesch-unload-v}

where $a_u$ is a constant of `r mod_coef_wind[['a']]` (m^-1^) and $b_u$ is a constant of `r mod_coef_wind[['b']]` (m^-1^), and $u_{th}$ is a threshold wind speed below which $f(u)$ is equal to zero.

```{r}
wind_err_tbl <- readRDS('data/modelled_wind_unloading_error_table.rds') |> 
  mutate(model = 'wind_model')
temp_err_tbl <- readRDS('data/modelled_temp_unloading_error_table.rds') |> 
  mutate(model = 'temp_model')

rbind(wind_err_tbl, temp_err_tbl)

```


![](figs/results/modelled_canopy_snowload_unloading_w_obs.png){#fig-mod-cpy-load-unld}

To derive an analytical solution for $q_unld$ we start with the analytical equation to compute the canopy snow load for the next time step, $L^{t+\Delta t}$ due to unloading:

$$
L^{t+\Delta t} = L^{t} \cdot exp(-f(u) \Delta t)-(X_u \cdot q_{drip} \cdot \Delta t)
$${eq-qunl-analytical}

where $L_t$ is the canopy snow load for the current time step. 

Since change in canopy snow load due to unloading over a discrete time interval ($\Delta L$) is equal to the product of $q_{unld}$ and $\Delta t$ it can be expressed as:

$$
\Delta L = L^{t} - L^{t+\Delta t}
$${#eq-del-L-unl}

@eq-del-L-unl can be used to remove $L^{t+\Delta t}$ from @eq-qunl-analytical:

$$
\Delta L = L^{t} - \left[L^{t} \cdot exp(-\kappa_{unld} \Delta t)\right] + \left[X_u \cdot q_{drip} \cdot \Delta t\right]
$$

Factor out $L^{t}$ from the unloading term:

$$
\Delta L = L^{t} \cdot \left[1 - exp(-\kappa_{unld} \Delta t)\right]+ \left[X_u \cdot q_{drip} \cdot \Delta t\right]
$$


## Discussion

The inclusion of processes that ablate snow intercepted in the canopy is prevalent in many parameterizations for the initial loading of snow within the canopy. Many of these processes are related to the amount of time that snow resides in the canopy prior to the interception measurement was conducted in addition to wind and temeprature induced unloading processes. After filtering out unloading due to temperature and wind the duration snow was intercepted in the canopy was found as a third important factor to consider. Unloading due to duration initially starts high while the snow is fresh and has low cohesion and adhesion and as the snow metamorphasizes the adhesion and cohsesion increases for the first 15 hours and the probability of unloading declines. After 15 hours the probability of unloading increases potentially due to increased sublimation and metamorphasism of snow intercepted in the canopy which reduces its adhesion and cohesion. 

A new unloading routine could be established based on these observations after filtering to remove temperature and wind induced unloading which show the probability of unloading after this filtering is high after initial loading of snow intercepted in the canopy, followed by a decline in probability until around 15 hours, and increases afterwards. This could be combined with the unloading rate which was observed to be high as the snow was initially loaded in the canopy and then declines steadily with increasing duration. 

Based on the canopy snowmelt model, the @Storck2002 ratio based melt based unloading parameterization over estimates drip. It could also be that the parv snowmelt model is underestimating the canopy snow temperature. 

Generally, model over estimates canopy snow wind induced unloading when wind speed < 1 m/s (see weighed tree events 2023-02-26, 2023-01-28). Under estimates when wind speed > 1 m/s (see events 2023-02-24).  

Sometimes the overestimate of wind unloading for < 1 m/s is associated with higher canopy snow loads (see 2023-02-24 at the start, and 2023-03-14 at the start). But not necessarily for 2022-12-01 and 2023-03-25/26/28 which both either underestimate $q_unld^wind$ or have good performance with high canopy snow loads.

Underestimates canopy snow melt for colder/near 0 events (see 2023-03-25)

2023-03-26 not sure why ablation late on the 26th, as high humidity (~100%) and not too high wind speeds (~1m/s)

The wind dominated ablation events have much poorer performance, aside from 2022-12-01 which aligns well on average. 

The sublimation or snowmelt dominated events, which are less influenced by wind have the best performance.

 The wind model is slightly less sensitive, with lower unloading rates at the same wind speeds compared to the @Roesch2001 relationships. 

## Conclusions

-   Over two winter seasons, the primary processes contributing to canopy snow ablation were unloading, drip, and sublimation. Wind redistribution of canopy snow was determined to be a small component of the mass balance. 
-   The probability of unloading was observed to increase with air temperature and wind speed. However, the probability of wind induced unloading was observed to decrease at warmer air temperatures. The probability of unloading due to warming was also observed to decline when wind speeds were above 1 m s^-1^. The increase in cohesion and adhesion of snow in the canopy at warmer temperatures and cooling due to wind-induced evaporation may contribute to the interaction multivariate interaction between air temperature, wind speed and canopy snow unloading.  
-   The duration that snow is intercepted in the canopy was found to first decrease the probability of unloading exponentially for the first 15 hours, followed by an exponential increase in the probability of unloading for the remaining duration that snow is intercepted in the canopy. 
-   Exponential relationships were observed between both air temperature and wind speed with unloading and drip, which were also dependent on the amount of snow intercepted in the canopy. In comparison to existing models, this discontinuous forest exhibited unloading and drip due to warming at lower air temperatures. Conversely, wind-induced unloading occurred at higher wind speeds than predicted by current models.

-   The canopy snow exposure coef from existing studies was found to be too small at this site and needed to be increased substantially 
-   The amount of drip compared to mass release of canopy snow was found to be significatnly less in this study compared to previous studies which suggested primarily drip

results show updated model is more consistent across temperaturs and wind speed


# References
